SELECT 
	a.staff_code,
    sbd.shift_type,
    CASE WHEN sbd.shift_type = 'Shifting' THEN (SELECT day_count FROM hrardb.calendars WHERE MONTH = EXTRACT(MONTH FROM '2023-11-30') AND shift_type = 'shifting') * 8
		 ELSE (SELECT day_count FROM hrardb.calendars WHERE MONTH = EXTRACT(MONTH FROM '2023-11-30') AND shift_type = 'compressed') * 9.25 END AS working_days,
         count(
			CASE WHEN a.holiday IS NOT NULL AND a.lwop IS NOT NULL THEN 0
				 WHEN a.np IS NOT NULL AND a.lwop IS NOT NULL THEN 0
				 WHEN a.leave_type IS NOT NULL AND a.lwop IS NOT NULL THEN 0
                 WHEN a.att_st IS NOT NULL AND a.att_end IS NULL AND a.lwop IS NOT NULL THEN 0
                 WHEN a.att_st IS NOT NULL AND a.lwop IS NOT NULL THEN 0
				 WHEN a.att_end IS NOT NULL AND a.lwop IS NOT NULL THEN 0
                 ELSE 1 END
         ) * IF(sbd.shift_type = 'Shifting', 8, 9.25) AS lwop
FROM hrardb.attendances a
LEFT JOIN hrardb.staff_base_details sbd
	ON a.staff_code = sbd.staff_code
WHERE a.staff_code = '0301416'
group by a.staff_code;